(this.webpackJsonpdiagexp1=this.webpackJsonpdiagexp1||[]).push([[0],{50:function(t,e,n){t.exports=n(82)},55:function(t,e,n){},56:function(t,e,n){},82:function(t,e,n){"use strict";n.r(e);var o,r,i,a=n(0),c=n.n(a),l=n(18),s=n.n(l),u=(n(55),n(56),n(47)),h=n(10),d=n(5),m=n(2),p=n(3),y=n(7),f=n(6),g=n(12),b=n(8),k=n(4),v=(n(16),n(19)),O=n(20),w=n(11),j=Object(w.a)(o=function(t){function e(){return Object(m.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(b.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this;return c.a.createElement("g",{transform:"translate(".concat(this.props.slot.position.x,",").concat(this.props.slot.position.y,") rotate(0)"),onClick:function(e){return t.onClick(e)}},c.a.createElement("circle",{r:"3",fill:"gray"}))}},{key:"onClick",value:function(t){}}]),e}(c.a.Component))||o,S=n(1),x=Object(w.a)(r=function(t){function e(t){var n;return Object(m.a)(this,e),(n=Object(y.a)(this,Object(f.a)(e).call(this,t))).myRef=c.a.createRef(),Object(S.e)((function(){if(n.props.block.finishedResizing&&n.myRef.current){var t=n.myRef.current.getBBox().width+20;t!=n.props.block.requestedWidth&&(n.props.block.requestedWidth=t)}})),n}return Object(b.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){this.myRef.current&&(this.props.block.requestedWidth=this.myRef.current.getBBox().width+20)}},{key:"render",value:function(){return c.a.createElement("text",{ref:this.myRef,style:{pointerEvents:"none",userSelect:"none"},x:this.props.block.rect.width/2,y:this.props.block.rect.height/2,dominantBaseline:"middle",textAnchor:"middle"},this.props.block.name)}}]),e}(c.a.Component))||r,C=Object(w.a)(i=function(t){function e(){return Object(m.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(b.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this;return c.a.createElement("g",{transform:"translate(".concat(this.props.block.rect.x+this.props.block.translate.x,",").concat(this.props.block.rect.y+this.props.block.translate.y,") rotate(0)"),onMouseDown:function(e){return t.onMouseDown(e)},onClick:function(e){return t.onClick(e)},onDoubleClick:function(e){return t.onDoubleClick(e)}},c.a.createElement("rect",{width:this.props.block.rect.width,height:this.props.block.rect.height,fill:"white",style:{stroke:"#006600"},rx:5}),"mmroot"===this.props.block.type?c.a.createElement("rect",{x:"3",y:"3",width:this.props.block.rect.width-6,height:this.props.block.rect.height-6,fill:"white",style:{stroke:"#006600"},rx:5}):null,this.props.block.isEdited?null:c.a.createElement(x,{block:this.props.block}),this.props.block.slots.map((function(t){return c.a.createElement(j,{key:t.key,slot:t})})))}},{key:"onMouseDown",value:function(t){this.props.onSelect(this.props.block,{x:t.clientX,y:t.clientY}),t.stopPropagation()}},{key:"onClick",value:function(t){this.props.block.click(),t.stopPropagation()}},{key:"onDoubleClick",value:function(t){this.props.block.doubleClick()}}]),e}(c.a.Component))||i,B=function(){function t(){Object(m.a)(this,t),this.map=new Map}return Object(p.a)(t,[{key:"push",value:function(t,e){var n=this.map.get(t)||[];n.push(e),this.map.set(t,n)}},{key:"get",value:function(t){return this.map.get(t)||[]}},{key:"empty",value:function(t){return 0===this.get(t).length}},{key:"keys",value:function(){return this.map.keys()}}]),t}();function D(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}function P(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];for(var r=0,i=n;r<i.length;r++){var a=i[r],c=t.indexOf(a);-1!==c&&t.splice(c,1)}return t}function E(t){return Math.sqrt(t.x*t.x+t.y*t.y)}var M,U=function(t){function e(){return Object(m.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(b.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return c.a.createElement("g",null,c.a.createElement("g",{id:"g3979",transform:"translate(-0.10620686,-0.56696429)"},c.a.createElement("rect",{ry:"1.0444876",y:"-9.3742828",x:"-9.8492556",height:"19.63636",width:"19.425177",id:"rect3942",style:{fill:"white",stroke:"#000000",strokeWidth:"1"}}),c.a.createElement("path",{id:"rect3944",d:"m -3.3174074,-7.0890472 c -0.5786464,0 -1.0443792,0.4657354 -1.0443792,1.0443818 v 2.1626565 h -2.1626592 c -0.5786464,0 -1.0443818,0.4657355 -1.0443818,1.0443819 v 6.7313729 c 0,0.5786438 0.4657354,1.0443792 1.0443818,1.0443792 h 2.1626592 v 2.1626592 c 0,0.5786464 0.4657328,1.0443792 1.0443792,1.0443792 h 6.7313729 c 0.5786464,0 1.0443819,-0.4657328 1.0443819,-1.0443792 V 4.9381251 h 2.1626565 c 0.5786464,0 1.0443818,-0.4657354 1.0443818,-1.0443792 V -2.837627 c 0,-0.5786464 -0.4657354,-1.0443819 -1.0443818,-1.0443819 H 4.4583474 v -2.1626565 c 0,-0.5786464 -0.4657355,-1.0443818 -1.0443819,-1.0443818 z",style:{fill:"purple",stroke:"#000000",strokeWidth:"1"}})))}}]),e}(c.a.Component),R=function(t){function e(){return Object(m.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(b.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return c.a.createElement("g",null,c.a.createElement("g",{id:"g3979",transform:"translate(-0.10620686,-0.56696429)"},c.a.createElement("rect",{ry:"1.0444876",y:"-9.3742828",x:"-9.8492556",height:"19.63636",width:"19.425177",id:"rect3942",style:{fill:"white",stroke:"#000000",strokeWidth:"1"}}),c.a.createElement("rect",{style:{fill:"white",stroke:"#000000",strokeWidth:"1"},id:"rect4021",width:"15.485204",height:"8.2242823",x:"-7.7426019",y:"-4.1617403",ry:"0.98811853"})))}}]),e}(c.a.Component),W=function(t){function e(){return Object(m.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(b.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this,e=c.a.createElement("rect",{width:10,height:10,fill:this.props.button.color});switch(this.props.button.icon){case"add":e=c.a.createElement(U,null);break;case"remove":e=c.a.createElement(R,null)}return c.a.createElement("g",{transform:"translate(".concat(this.props.button.position.x,",").concat(this.props.button.position.y,") rotate(0)"),onClick:function(e){return t.onClick(e)}},e)}},{key:"onClick",value:function(t){this.props.button.click()}}]),e}(c.a.Component),z=Object(w.a)(M=function(t){function e(){return Object(m.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(b.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this.props.connection.fromPoint.x,e=this.props.connection.fromPoint.y,n=this.props.connection.toPoint.x,o=this.props.connection.toPoint.y;return c.a.createElement("path",{style:{stroke:"rgb(255,0,0)",strokeWidth:"2",fill:"none"},d:"M ".concat(t," ").concat(e," C ").concat(n," ").concat(e," ").concat(t," ").concat(o," ").concat(n," ").concat(o)})}}]),e}(c.a.Component))||M,T=n(14);T.CategoryServiceFactory.setDefaultConfiguration(new T.CategoryConfiguration(T.LogLevel.Info));var I,L,J,q,F=new T.Category("mindMap"),H=new T.Category("draging",F),A=new T.Category("diagramBlockLayout",F),K=new T.Category("DiagramSceneComponent"),X=Object(w.a)((L=function(t){function e(){var t,n;Object(m.a)(this,e);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(n=Object(y.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(r)))).mouseDownPos=void 0,n.selectedBlock=void 0,n}return Object(b.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this,e=this.props.diagramScene.sceneTranslate.x+this.props.diagramScene.sceneTranslateDelta.x,n=this.props.diagramScene.sceneTranslate.y+this.props.diagramScene.sceneTranslateDelta.y;return c.a.createElement("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",onMouseDown:function(e){return t.onMouseDown(e)},onMouseMove:function(e){return t.onMouseMove(e)},onMouseUp:function(e){return t.onMouseUp(e)},onClick:function(e){return t.onClick(e)}},c.a.createElement("g",{transform:"translate(".concat(e,",").concat(n,")")},this.props.diagramScene.diagramBlocks.map((function(e){return c.a.createElement(C,{key:e.uid,block:e,onSelect:function(e,n){return t.onSelect(e,n)}})})),this.props.diagramScene.diagramConnections.map((function(t){return c.a.createElement(z,{key:t.uid,connection:t})})),this.props.diagramScene.activeButtons.map((function(t){return c.a.createElement(W,{key:t.uid,button:t})}))))}},{key:"onSelect",value:function(t,e){this.mouseDownPos=this.clientToScene(e),this.selectedBlock=t}},{key:"onMouseDown",value:function(t){K.info("onMouseDown"),this.props.diagramScene.editedBlock&&(this.props.diagramScene.editedBlock.isEdited=!1,this.props.diagramScene.editedBlock=void 0,this.props.diagramScene.onEdit=!0),this.mouseDownPos=this.clientToScene({x:t.clientX,y:t.clientY})}},{key:"onMouseMove",value:function(t){if(this.mouseDownPos&&this.selectedBlock){K.info("onMouseMove block");var e=this.clientToScene({x:t.clientX,y:t.clientY});this.selectedBlock.translate={x:e.x-this.mouseDownPos.x,y:e.y-this.mouseDownPos.y},this.props.diagramScene.activeButtons=[]}else if(this.mouseDownPos){K.info("onMouseMove scene");var n=this.clientToScene({x:t.clientX,y:t.clientY}),o=n.x-this.mouseDownPos.x,r=n.y-this.mouseDownPos.y;E({x:o,y:r})>40&&(this.props.diagramScene.sceneTranslateDelta={x:o,y:r})}}},{key:"onMouseUp",value:function(t){if(K.info("onMouseUp"),this.selectedBlock&&this.mouseDownPos){var e=this.clientToScene({x:t.clientX,y:t.clientY});if(E({x:e.x-this.mouseDownPos.x,y:e.y-this.mouseDownPos.y})>20){var n={x:this.selectedBlock.rect.x+e.x-this.mouseDownPos.x,y:this.selectedBlock.rect.y+e.y-this.mouseDownPos.y};this.selectedBlock.setPosition(n),this.selectedBlock.dragEnd(e)}else this.selectedBlock.translate={x:0,y:0};this.selectedBlock=void 0,this.mouseDownPos=void 0}else if(this.mouseDownPos){var o=this.clientToScene({x:t.clientX,y:t.clientY}),r=o.x-this.mouseDownPos.x,i=o.y-this.mouseDownPos.y;E({x:r,y:i})>40&&(this.props.diagramScene.sceneTranslate.x+=r,this.props.diagramScene.sceneTranslate.y+=i),this.props.diagramScene.sceneTranslateDelta={x:0,y:0},this.mouseDownPos=void 0}}},{key:"clientToScene",value:function(t){return{x:t.x-this.props.diagramScene.sceneTranslate.x,y:t.y-this.props.diagramScene.sceneTranslate.y}}},{key:"onClick",value:function(t){this.props.diagramScene.activeButtons=[]}}]),e}(c.a.Component),Object(k.a)(L.prototype,"onMouseDown",[S.d],Object.getOwnPropertyDescriptor(L.prototype,"onMouseDown"),L.prototype),Object(k.a)(L.prototype,"onMouseMove",[S.d],Object.getOwnPropertyDescriptor(L.prototype,"onMouseMove"),L.prototype),Object(k.a)(L.prototype,"onMouseUp",[S.d],Object.getOwnPropertyDescriptor(L.prototype,"onMouseUp"),L.prototype),I=L))||I,N=function(){function t(){Object(m.a)(this,t)}return Object(p.a)(t,[{key:"layoutBlockButtons",value:function(t,e){var n=new B,o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;n.push(l.positionHint,l)}}catch(g){r=!0,i=g}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}var s=t.rect,u=s.x+s.width-10,h=s.y-10-4,d=!0,m=!1,p=void 0;try{for(var y,f=n.get("topRight")[Symbol.iterator]();!(d=(y=f.next()).done);d=!0){y.value.position={x:u,y:h},u-=24}}catch(g){m=!0,p=g}finally{try{d||null==f.return||f.return()}finally{if(m)throw p}}}}]),t}(),Y=(J=function(){function t(e){Object(m.a)(this,t),this.scene=e}return Object(p.a)(t,[{key:"getOutputSlotConnections",value:function(t,e){return this.blockConnections.output.get(t).filter((function(t){return t.from.slot===e}))}},{key:"getInputSlotConnections",value:function(t,e){return this.blockConnections.input.get(t).filter((function(t){return t.to.slot===e}))}},{key:"getChildBlocks",value:function(t){var e=[],n=!0,o=!1,r=void 0;try{for(var i,a=this.blockConnections.output.get(t)[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var c=i.value;e.push(c.to.blockUid),e.push.apply(e,Object(h.a)(this.getChildBlocks(c.to.blockUid)))}}catch(l){o=!0,r=l}finally{try{n||null==a.return||a.return()}finally{if(o)throw r}}return e}},{key:"blocks",get:function(){var t=new Map,e=!0,n=!1,o=void 0;try{for(var r,i=this.scene.diagramBlocks[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;t.set(a.uid,a)}}catch(c){n=!0,o=c}finally{try{e||null==i.return||i.return()}finally{if(n)throw o}}return t}},{key:"blockConnections",get:function(){var t=new B,e=new B,n=!0,o=!1,r=void 0;try{for(var i,a=this.scene.diagramConnections[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var c=i.value;t.push(c.to.blockUid,c),e.push(c.from.blockUid,c)}}catch(l){o=!0,r=l}finally{try{n||null==a.return||a.return()}finally{if(o)throw r}}return{input:t,output:e}}}]),t}(),Object(k.a)(J.prototype,"blocks",[S.f],Object.getOwnPropertyDescriptor(J.prototype,"blocks"),J.prototype),Object(k.a)(J.prototype,"blockConnections",[S.f],Object.getOwnPropertyDescriptor(J.prototype,"blockConnections"),J.prototype),J),V=(q=function(){function t(e){Object(m.a)(this,t),this.diagramStructure=e}return Object(p.a)(t,[{key:"layout",value:function(){var t=this.diagramStructure.scene.diagramBlocks[0];if("mmroot"!==t.type)throw new Error("Invalid diagram structure");t.slots[0].position={x:0,y:t.rect.height/2},t.slots[1].position={x:t.rect.width,y:t.rect.height/2};var e=this.diagramStructure.getOutputSlotConnections(t.uid,"or"),n=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;n.push(l.to.blockUid),n.push.apply(n,Object(h.a)(this.diagramStructure.getChildBlocks(l.to.blockUid)))}}catch(C){r=!0,i=C}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}var s=this.diagramStructure.getOutputSlotConnections(t.uid,"ol"),u=[],d=!0,m=!1,p=void 0;try{for(var y,f=s[Symbol.iterator]();!(d=(y=f.next()).done);d=!0){var g=y.value;u.push(g.to.blockUid),u.push.apply(u,Object(h.a)(this.diagramStructure.getChildBlocks(g.to.blockUid)))}}catch(C){m=!0,p=C}finally{try{d||null==f.return||f.return()}finally{if(m)throw p}}for(var b=0,k=n;b<k.length;b++){var v=k[b],O=this.diagramStructure.blocks.get(v);O.slots[0].position={x:0,y:O.rect.height/2},O.slots[1].position={x:O.rect.width,y:O.rect.height/2}}for(var w=0,j=u;w<j.length;w++){var S=j[w],x=this.diagramStructure.blocks.get(S);x.slots[0].position={x:x.rect.width,y:x.rect.height/2},x.slots[1].position={x:0,y:x.rect.height/2}}}}]),t}(),Object(k.a)(q.prototype,"layout",[S.d],Object.getOwnPropertyDescriptor(q.prototype,"layout"),q.prototype),q),$=function(){function t(e){Object(m.a)(this,t),this.diagramStructure=e,this.disposers=[]}return Object(p.a)(t,[{key:"layout",value:function(){var t=this,e=!0,n=!1,o=void 0;try{for(var r,i=this.disposers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){(0,r.value)()}}catch(d){n=!0,o=d}finally{try{e||null==i.return||i.return()}finally{if(n)throw o}}var a=!0,c=!1,l=void 0;try{for(var s,u=function(){var e=s.value,n=t.diagramStructure.blocks.get(e.from.blockUid),o=t.diagramStructure.blocks.get(e.to.blockUid);t.disposers.push(Object(S.e)((function(){return t.setConnectionPosition(e,n,o)}),{delay:30}))},h=this.diagramStructure.scene.diagramConnections[Symbol.iterator]();!(a=(s=h.next()).done);a=!0)u()}catch(d){c=!0,l=d}finally{try{a||null==h.return||h.return()}finally{if(c)throw l}}}},{key:"setConnectionPosition",value:function(t,e,n){var o=e.name2slot.get(t.from.slot).position,r=n.name2slot.get(t.to.slot).position;t.fromPoint={x:o.x+e.rect.x+e.translate.x,y:o.y+e.rect.y+e.translate.y},t.toPoint={x:r.x+n.rect.x+n.translate.x,y:r.y+n.rect.y+n.translate.y}}}]),t}(),G=n(15);function Q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Z(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Q(n,!0).forEach((function(e){Object(G.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _,tt,et,nt,ot,rt,it,at,ct,lt,st,ut,ht,dt,mt,pt,yt,ft={hMargin:30,vMargin:10},gt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ft;Object(m.a)(this,t),this.diagramStructure=e,this.parameters=n,this.blockColumns=new Map,this.columnBlocks=new B,this.childShift=new Map,this.blockHeight=new Map,this.blockChildWidth=new Map,this.columnWidth=new Map,this.columnCenter=new Map,this.blockPosition=new Map}return Object(p.a)(t,[{key:"layoutColumns",value:function(){if(!this.diagramStructure)throw new Error("Diagram data not defined");var t=this.diagramStructure.scene.diagramBlocks;this.blockColumns=new Map,this.columnBlocks=new B;for(var e=this.diagramStructure.blockConnections.input,n=0;n<t.length;++n)if(0===n){if(this.blockColumns.set(t[n].uid,0),this.columnBlocks.push(n,t[n].uid),!e.empty(t[n].uid))throw new Error("Invalid mm diagram blocks structure (first block must be root block - no input connections)")}else{var o=e.get(t[n].uid);if(1!==o.length)throw new Error("Invalid mm diagram blocks structure (each block except root must have exactly one input connection )");var r=this.blockColumns.get(o[0].from.blockUid);if(void 0===r)throw new Error("Invalid mm diagram blocks structure (parent block must preceed child block)");var i=r;0===i?"or"===o[0].from.slot?i+=1:i-=1:i>0?i+=1:i<0&&(i-=1),this.blockColumns.set(t[n].uid,i),this.columnBlocks.push(i,t[n].uid)}}},{key:"layout",value:function(){var t=this.diagramStructure.blockConnections,e=t.input,n=t.output;this.layoutColumns();for(var o=Array.from(this.columnBlocks.keys()).sort((function(t,e){return t-e})),r=o[0],i=o[o.length-1],a=r;a<=i;++a){var c=0,l=!0,s=!1,u=void 0;try{for(var h,d=this.columnBlocks.get(a)[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var m=h.value;c=Math.max(c,this.diagramStructure.blocks.get(m).rect.width)}}catch(z){s=!0,u=z}finally{try{l||null==d.return||d.return()}finally{if(s)throw u}}this.columnWidth.set(a,c)}var p=0;this.columnCenter.set(0,0);for(var y=1;y<=i;++y){var f=this.columnWidth.get(y-1),g=this.columnWidth.get(y);p=p+f/2+this.parameters.hMargin+g/2,this.columnCenter.set(y,p)}p=0;for(var b=-1;b>=r;--b){var k=this.columnWidth.get(b+1),v=this.columnWidth.get(b);p=p-k/2-this.parameters.hMargin-v/2,this.columnCenter.set(b,p)}var O=this.diagramStructure.scene.diagramBlocks[0];if(e.get(O.uid).length>0)throw new Error("Invalid diagram structure, root block has input connections");var w=!0,j=!1,S=void 0;try{for(var x,C=n.get(O.uid)[Symbol.iterator]();!(w=(x=C.next()).done);w=!0){var B=x.value;this.updateChildHeight(B.to.blockUid)}}catch(z){j=!0,S=z}finally{try{w||null==C.return||C.return()}finally{if(j)throw S}}this.blockPosition.set(O.uid,{x:0,y:0}),this.updateChildPositions(1,this.columnBlocks.get(1),{x:0,y:0}),this.updateChildPositions(-1,this.columnBlocks.get(-1),{x:0,y:0});var D=!0,P=!1,E=void 0;try{for(var M,U=this.diagramStructure.scene.diagramBlocks[Symbol.iterator]();!(D=(M=U.next()).done);D=!0){var R=M.value,W=this.blockPosition.get(R.uid);R.rect=Z({},R.rect,{x:W.x-R.rect.width/2,y:W.y-R.rect.height/2})}}catch(z){P=!0,E=z}finally{try{D||null==U.return||U.return()}finally{if(P)throw E}}}},{key:"updateChildPositions",value:function(t,e,n){if(!this.diagramStructure)throw new Error("Diagram data not defined");var o=0,r=!0,i=!1,a=void 0;try{for(var c,l=e[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var s=c.value;o+=this.blockHeight.get(s)}}catch(O){i=!0,a=O}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}o+=(e.length-1)*this.parameters.vMargin;var u=n.y-o/2,h=this.columnCenter.get(t);t>0?t+=1:t-=1;var d=!0,m=!1,p=void 0;try{for(var y,f=e[Symbol.iterator]();!(d=(y=f.next()).done);d=!0){var g=y.value,b=this.blockHeight.get(g),k={x:h,y:u+b/2};this.blockPosition.set(g,k);var v=this.diagramStructure.blockConnections.output.get(g).map((function(t){return t.to.blockUid}));this.updateChildPositions(t,v,k),u+=b+this.parameters.vMargin}}catch(O){m=!0,p=O}finally{try{d||null==f.return||f.return()}finally{if(m)throw p}}}},{key:"updateChildHeight",value:function(t){var e=this.diagramStructure.blocks.get(t),n=this.diagramStructure.blockConnections.output.get(t),o=0,r=!0,i=!1,a=void 0;try{for(var c,l=n[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var s=c.value;o+=this.updateChildHeight(s.to.blockUid)}}catch(h){i=!0,a=h}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}o+=this.parameters.vMargin*(n.length-1);var u=Math.max(o,e.rect.height);return this.blockHeight.set(t,u),u}},{key:"getBlockColumn",value:function(t){return this.blockColumns.get(t)}},{key:"getBlocks",value:function(t){var e=[],n=!0,o=!1,r=void 0;try{for(var i,a=this.diagramStructure.scene.diagramBlocks[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var c=i.value,l=c.rect;t.x>l.x&&t.x<l.x+l.width&&t.y>l.y&&t.y<l.y+l.height&&e.push(c)}}catch(s){o=!0,r=s}finally{try{n||null==a.return||a.return()}finally{if(o)throw r}}return e}},{key:"getChildIdx",value:function(t,e,n){var o=this;if(!this.diagramStructure)throw new Error("Diagram data not defined");var r=[],i=this.diagramStructure.blockConnections.output,a=!0,c=!1,l=void 0;try{for(var s,u=i.get(e)[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var h=s.value;r.push(h.to.blockUid)}}catch(w){c=!0,l=w}finally{try{a||null==u.return||u.return()}finally{if(c)throw l}}r=r.filter((function(e){return t!==e})),A.info("Found child uids ".concat(r));var d=r.map((function(t){return o.diagramStructure.blocks.get(t)})).map((function(t){return o.diagramStructure.scene.diagramBlocks.indexOf(t)})).sort((function(t,e){return t-e})),m=d.map((function(t){return[t,o.diagramStructure.scene.diagramBlocks[t].rect.y,o.diagramStructure.scene.diagramBlocks[t].rect.height]}));A.info((function(){return"getChildIdx block rects ".concat(m)}));var p=0,y=!0,f=!1,g=void 0;try{for(var b,k=d[Symbol.iterator]();!(y=(b=k.next()).done);y=!0){var v=b.value,O=this.diagramStructure.scene.diagramBlocks[v].rect;if(n<O.y+O.height/2)break;p++}}catch(w){f=!0,g=w}finally{try{y||null==k.return||k.return()}finally{if(f)throw g}}return[p,d]}},{key:"getColumnIdx",value:function(t){var e=Math.max.apply(Math,Object(h.a)(Array.from(this.columnWidth.keys()))),n=Math.min.apply(Math,Object(h.a)(Array.from(this.columnWidth.keys()))),o=-this.columnWidth.get(0)/2;if(t>=o){for(var r=0;r<=e;++r){if(t<(o+=this.columnWidth.get(r)))return r;o+=this.parameters.hMargin}return null}for(var i=-1;i>=n;--i){if(t>(o-=this.columnWidth.get(i)))return i;o-=this.parameters.hMargin}return null}}]),t}(),bt=(_=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(m.a)(this,t),Object(d.a)(this,"diagramBlocks",tt,this),Object(d.a)(this,"diagramConnections",et,this),Object(d.a)(this,"activeButtons",nt,this),Object(d.a)(this,"editedBlock",ot,this),Object(d.a)(this,"onEdit",rt,this),Object(d.a)(this,"structureChanging",it,this),this.sceneTranslate={x:512,y:500},Object(d.a)(this,"sceneTranslateDelta",at,this),this.diagramStructure=void 0,this.buttonLayout=new N,this.slotLayout=void 0,this.blockLayout=void 0,this.connectionLayout=void 0,this.diagramBlocks=n,this.diagramConnections=o,this.diagramStructure=new Y(this),this.slotLayout=new V(this.diagramStructure),this.blockLayout=new gt(this.diagramStructure),this.connectionLayout=new $(this.diagramStructure),Object(S.e)((function(){var t=!1,n=!0,o=!1,r=void 0;try{for(var i,a=e.diagramBlocks[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var c=i.value;c.requestedWidth&&c.finishedResizing&&c.rect.width!=c.requestedWidth&&(c.rect.width=c.requestedWidth,t=!0)}}catch(l){o=!0,r=l}finally{try{n||null==a.return||a.return()}finally{if(o)throw r}}t&&e.layout()}),{name:"asd"})}return Object(p.a)(t,[{key:"showBlockButtons",value:function(t,e){var n=this;this.buttonLayout.layoutBlockButtons(t,e),this.activeButtons=e;var o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){a.value.on("click",(function(){n.activeButtons=[]}))}}catch(l){r=!0,i=l}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}}},{key:"layout",value:function(){this.diagramBlocks.length>0&&(this.slotLayout.layout(),this.blockLayout.layout(),this.connectionLayout.layout())}}]),t}(),tt=Object(k.a)(_.prototype,"diagramBlocks",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),et=Object(k.a)(_.prototype,"diagramConnections",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nt=Object(k.a)(_.prototype,"activeButtons",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ot=Object(k.a)(_.prototype,"editedBlock",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rt=Object(k.a)(_.prototype,"onEdit",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),it=Object(k.a)(_.prototype,"structureChanging",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),at=Object(k.a)(_.prototype,"sceneTranslateDelta",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{x:0,y:0}}}),Object(k.a)(_.prototype,"layout",[S.d],Object.getOwnPropertyDescriptor(_.prototype,"layout"),_.prototype),_);function kt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var vt,Ot,wt,jt,St,xt,Ct,Bt,Dt=(ct=function(t){function e(t,n,o,r,i){var a;return Object(m.a)(this,e),(a=Object(y.a)(this,Object(f.a)(e).call(this))).uid=void 0,Object(d.a)(a,"name",lt,Object(g.a)(a)),a.type=void 0,Object(d.a)(a,"rect",st,Object(g.a)(a)),Object(d.a)(a,"translate",ut,Object(g.a)(a)),Object(d.a)(a,"slots",ht,Object(g.a)(a)),Object(d.a)(a,"debugIdx",dt,Object(g.a)(a)),Object(d.a)(a,"finishedResizing",mt,Object(g.a)(a)),Object(d.a)(a,"requestedWidth",pt,Object(g.a)(a)),Object(d.a)(a,"isEdited",yt,Object(g.a)(a)),a.uid=t,a.name=n,a.type=o,a.slots=r,a.rect=i,a.debugIdx=0,a.translate={x:0,y:0},a}return Object(b.a)(e,t),Object(p.a)(e,[{key:"setPosition",value:function(t){this.translate={x:0,y:0},this.rect=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kt(n,!0).forEach((function(e){Object(G.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kt(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},this.rect,{},t),this.fireChangeRect(this)}},{key:"click",value:function(){this.fireClick(this)}},{key:"doubleClick",value:function(){this.fireDoubleClick(this)}},{key:"dragEnd",value:function(t){this.fireDragEnd(this,t)}},{key:"name2slot",get:function(){var t=new Map,e=!0,n=!1,o=void 0;try{for(var r,i=this.slots[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;t.set(a.name,a)}}catch(c){n=!0,o=c}finally{try{e||null==i.return||i.return()}finally{if(n)throw o}}return t}}]),e}(function(){function t(){Object(m.a)(this,t),this.clickCallbacks=[],this.doubleClickCallbacks=[],this.changeRectCallbacks=[],this.dragEndCallbacks=[]}return Object(p.a)(t,[{key:"on",value:function(t,e){switch(t){case"click":this.clickCallbacks.push(e);break;case"doubleClick":this.doubleClickCallbacks.push(e);break;case"changeRect":this.changeRectCallbacks.push(e);break;case"dragEnd":this.dragEndCallbacks.push(e)}}},{key:"fireClick",value:function(t){var e=!0,n=!1,o=void 0;try{for(var r,i=this.clickCallbacks[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){(0,r.value)(t)}}catch(a){n=!0,o=a}finally{try{e||null==i.return||i.return()}finally{if(n)throw o}}}},{key:"fireDoubleClick",value:function(t){var e=!0,n=!1,o=void 0;try{for(var r,i=this.doubleClickCallbacks[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){(0,r.value)(t)}}catch(a){n=!0,o=a}finally{try{e||null==i.return||i.return()}finally{if(n)throw o}}}},{key:"fireChangeRect",value:function(t){var e=!0,n=!1,o=void 0;try{for(var r,i=this.changeRectCallbacks[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){(0,r.value)(t)}}catch(a){n=!0,o=a}finally{try{e||null==i.return||i.return()}finally{if(n)throw o}}}},{key:"fireDragEnd",value:function(t,e){var n=!0,o=!1,r=void 0;try{for(var i,a=this.dragEndCallbacks[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){(0,i.value)(t,e)}}catch(c){o=!0,r=c}finally{try{n||null==a.return||a.return()}finally{if(o)throw r}}}}]),t}()),lt=Object(k.a)(ct.prototype,"name",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=Object(k.a)(ct.prototype,"rect",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ut=Object(k.a)(ct.prototype,"translate",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ht=Object(k.a)(ct.prototype,"slots",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt=Object(k.a)(ct.prototype,"debugIdx",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=Object(k.a)(ct.prototype,"finishedResizing",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pt=Object(k.a)(ct.prototype,"requestedWidth",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yt=Object(k.a)(ct.prototype,"isEdited",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(k.a)(ct.prototype,"setPosition",[S.d],Object.getOwnPropertyDescriptor(ct.prototype,"setPosition"),ct.prototype),Object(k.a)(ct.prototype,"name2slot",[S.f],Object.getOwnPropertyDescriptor(ct.prototype,"name2slot"),ct.prototype),ct),Pt=function(){function t(e,n,o,r,i){Object(m.a)(this,t),this.uid=e,this.positionHint=n,this.icon=o,this.color=r,this.position={x:0,y:0},this.clickCallbacks=[],i&&this.on("click",i)}return Object(p.a)(t,[{key:"click",value:function(){var t=!0,e=!1,n=void 0;try{for(var o,r=this.clickCallbacks[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){(0,o.value)()}}catch(i){e=!0,n=i}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}}},{key:"on",value:function(t,e){this.clickCallbacks.push(e)}}]),t}(),Et=(vt=function(){function t(e,n,o){Object(m.a)(this,t),this.from=e,this.to=n,this.type=o,Object(d.a)(this,"fromPoint",Ot,this),Object(d.a)(this,"toPoint",wt,this),this.fromPoint={x:0,y:0},this.toPoint={x:0,y:0}}return Object(p.a)(t,[{key:"uid",get:function(){return"".concat(this.from.blockUid,":").concat(this.from.slot,":").concat(this.to.blockUid,":").concat(this.to.slot)}}]),t}(),Ot=Object(k.a)(vt.prototype,"fromPoint",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wt=Object(k.a)(vt.prototype,"toPoint",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt),Mt=(jt=function(){function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};Object(m.a)(this,t),this.name=e,this.type=n,Object(d.a)(this,"position",St,this),this.position=o}return Object(p.a)(t,[{key:"key",get:function(){return this.name}}]),t}(),St=Object(k.a)(jt.prototype,"position",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt),Ut=function(){function t(){Object(m.a)(this,t)}return Object(p.a)(t,null,[{key:"fromJSON",value:function(t){var e=new bt,n=new Dt(D(),t.root.name,"mmroot",[new Mt("ol","o"),new Mt("or","o")],{x:100,y:100,width:200,height:30});return e.diagramBlocks.push(n),t.root.children&&t.root.children.left&&this.addChildBlocksFromJson(t.root.children.left,e,n,!0),t.root.children&&t.root.children.right&&this.addChildBlocksFromJson(t.root.children.right,e,n,!1),e}},{key:"addChildBlocksFromJson",value:function(t,e,n,o){var r=!0,i=!1,a=void 0;try{for(var c,l=t[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var s=c.value,u=new Dt(D(),s.name,"mm",[new Mt("i","i"),new Mt("o","o")],{x:100,y:100,width:200,height:30});e.diagramBlocks.push(u),"mmroot"==n.type?o?e.diagramConnections.push(new Et({blockUid:n.uid,slot:"ol"},{blockUid:u.uid,slot:"i"},"mm")):e.diagramConnections.push(new Et({blockUid:n.uid,slot:"or"},{blockUid:u.uid,slot:"i"},"mm")):e.diagramConnections.push(new Et({blockUid:n.uid,slot:"o"},{blockUid:u.uid,slot:"i"},"mm")),s.children&&this.addChildBlocksFromJson(s.children,e,u)}}catch(h){i=!0,a=h}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}}},{key:"toJSON",value:function(t){var e=t.diagramBlocks[0],n={root:{name:e.name}},o=t.diagramStructure.getOutputSlotConnections(e.uid,"ol");o.length>0&&(n.root.children={left:this.addChildBlocksFromScene(o,t)});var r=t.diagramStructure.getOutputSlotConnections(e.uid,"or");return r.length>0&&(n.root.children?n.root.children.right=this.addChildBlocksFromScene(r,t):n.root.children={right:this.addChildBlocksFromScene(r,t)}),n}},{key:"addChildBlocksFromScene",value:function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value,s=e.diagramStructure.blocks.get(l.to.blockUid),u={name:s.name},h=e.diagramStructure.getOutputSlotConnections(s.uid,"o");h.length>0&&(u.children=this.addChildBlocksFromScene(h,e)),n.push(u)}}catch(d){r=!0,i=d}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}}]),t}();function Rt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Wt(){var t=Object(v.a)(["\nwidth: 80%;\nheight: 60%;\nmargin-left: 7%;\nmargin-top:3px;\n"]);return Wt=function(){return t},t}function zt(){var t=Object(v.a)(["\n    position:absolute;\n    left :","px;\n    top : ","px;\n    width : ","px;\n    height : ","px;\n"]);return zt=function(){return t},t}var Tt,It,Lt,Jt=O.a.div(zt(),(function(t){return t.rect.x}),(function(t){return t.rect.y}),(function(t){return t.rect.width}),(function(t){return t.rect.height})),qt=O.a.input(Wt()),Ft=Object(w.a)(xt=function(t){function e(t){var n;return Object(m.a)(this,e),(n=Object(y.a)(this,Object(f.a)(e).call(this,t))).myRef=c.a.createRef(),n}return Object(b.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){this.props.block.finishedResizing=!1,this.myRef.current&&(this.myRef.current.focus(),this.myRef.current.setSelectionRange(0,this.props.block.name.length))}},{key:"componentWillUnmount",value:function(){this.props.block.finishedResizing=!0}},{key:"render",value:function(){var t=this;return c.a.createElement(qt,{ref:this.myRef,type:"text",value:this.props.block.name,onChange:function(e){t.props.block.name=e.target.value},onKeyDown:this.props.onKeyDown})}}]),e}(c.a.Component))||xt,Ht=Object(w.a)((Bt=function(t){function e(){return Object(m.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(b.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this;if(this.props.scene.editedBlock){var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Rt(n,!0).forEach((function(e){Object(G.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Rt(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},this.props.scene.editedBlock.rect);return e.x+=this.props.scene.sceneTranslate.x,e.y+=this.props.scene.sceneTranslate.y,c.a.createElement(Jt,{rect:e},c.a.createElement(Ft,{block:this.props.scene.editedBlock,onKeyDown:function(e){return t.handleKeyDown(e)}}))}return null}},{key:"handleKeyDown",value:function(t){this.props.scene.editedBlock&&"Enter"===t.key&&(this.props.scene.editedBlock.isEdited=!1,this.props.scene.editedBlock=void 0,this.props.scene.onEdit=!0,this.props.scene.activeButtons=[])}}]),e}(c.a.Component),Object(k.a)(Bt.prototype,"handleKeyDown",[S.d],Object.getOwnPropertyDescriptor(Bt.prototype,"handleKeyDown"),Bt.prototype),Ct=Bt))||Ct;function At(){var t=Object(v.a)(["\n    position:absolute;\n    width : 100%;\n    height : 100%;\n"]);return At=function(){return t},t}var Kt=O.a.div(At()),Xt=Object(w.a)((It=function(t){function e(t){var n;Object(m.a)(this,e),n=Object(y.a)(this,Object(f.a)(e).call(this,t)),Object(d.a)(n,"diagramScene",Lt,Object(g.a)(n)),n.vscode=void 0,n.vscode=n.props.vscode,n.diagramScene=new bt;var o=new Dt(D(),"Enter diagram name","mmroot",[new Mt("ol","o"),new Mt("or","o")],{x:0,y:0,width:100,height:30});return n.diagramScene.diagramBlocks.push(o),n.addCallbacks(n.diagramScene.diagramBlocks),n.diagramScene.layout(),window.addEventListener("message",(function(t){var e=t.data;if("setJsonDocument"===e.command){F.info("setJsonDocument",e.document);var o=e.document;n.vscode.setState(o),n.diagramScene=Ut.fromJSON(o),n.diagramScene.layout(),n.addCallbacks(n.diagramScene.diagramBlocks)}})),Object(S.e)((function(){if(n.diagramScene.onEdit&&n.vscode&&!n.diagramScene.editedBlock){var t=Ut.toJSON(n.diagramScene);n.vscode.postMessage({message:"setDocument",document:t}),n.vscode.setState(t),n.diagramScene.onEdit=!1}})),n}return Object(b.a)(e,t),Object(p.a)(e,[{key:"addCallbacks",value:function(t){var e=this,n=!0,o=!1,r=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var c=i.value;c.on("click",(function(t){var n=new Pt("addB","topRight","add","red",(function(){e.addBlock(t)})),o=new Pt("removeB","topRight","remove","red",(function(){e.removeBlock(t)}));e.diagramScene.showBlockButtons(t,[n,o])})),c.on("dragEnd",(function(t,n){F.info("Block drag end '".concat(t.name,"' (").concat(n.x,",").concat(n.y,")")),e.endDragging(t,n),e.diagramScene.layout()})),c.on("doubleClick",(function(t){t.isEdited=!0,F.info("Block double click ".concat(t.uid)),e.diagramScene.editedBlock=t,e.diagramScene.activeButtons=[]}))}}catch(l){o=!0,r=l}finally{try{n||null==a.return||a.return()}finally{if(o)throw r}}}},{key:"componentDidMount",value:function(){var t=this;this.vscode?this.vscode.postMessage({message:"getDocument"}):setTimeout((function(){var e=new bt,n=new Dt(D(),"Enter diagram name","mmroot",[new Mt("ol","o"),new Mt("or","o")],{x:0,y:0,width:100,height:30});e.diagramBlocks.push(n),t.diagramScene=e,console.log("New diagram scene"),t.addCallbacks(t.diagramScene.diagramBlocks),t.diagramScene.layout()}),500)}},{key:"render",value:function(){return c.a.createElement(Kt,null,c.a.createElement(Ht,{scene:this.diagramScene}),c.a.createElement(X,{diagramScene:this.diagramScene}))}},{key:"removeBlock",value:function(t){var e=this;if("mmroot"!==t.type){F.info("removeBlock ".concat(t.name));var n=this.diagramScene.diagramStructure.getChildBlocks(t.uid).map((function(t){return e.diagramScene.diagramStructure.blocks.get(t)}));n.push(t);var o=[],r=!0,i=!1,a=void 0;try{for(var c,l=n[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var s=c.value;o.push(this.diagramScene.diagramStructure.blockConnections.input.get(s.uid)[0])}}catch(O){i=!0,a=O}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}var u=!0,h=!1,d=void 0;try{for(var m,p=n[Symbol.iterator]();!(u=(m=p.next()).done);u=!0){var y=m.value,f=this.diagramScene.diagramBlocks.indexOf(y);this.diagramScene.diagramBlocks.splice(f,1)}}catch(O){h=!0,d=O}finally{try{u||null==p.return||p.return()}finally{if(h)throw d}}for(var g=0,b=o;g<b.length;g++){var k=b[g],v=this.diagramScene.diagramConnections.indexOf(k);this.diagramScene.diagramConnections.splice(v,1)}this.diagramScene.layout(),this.diagramScene.onEdit=!0,console.log(this.diagramScene.diagramBlocks.length,this.diagramScene.diagramConnections.length)}}},{key:"addBlock",value:function(t){F.info("addBlock (parent=".concat(t.name,")"));var e,n=new Dt(D(),"Unnamed element","mm",[new Mt("i","i"),new Mt("o","o")],{x:50,y:10,width:100,height:30});this.addCallbacks([n]),e="mmroot"===t.type?new Et({blockUid:t.uid,slot:"or"},{blockUid:n.uid,slot:"i"},"mm"):new Et({blockUid:t.uid,slot:"o"},{blockUid:n.uid,slot:"i"},"mm"),this.diagramScene.diagramBlocks.push(n),this.diagramScene.diagramConnections.push(e),this.diagramScene.layout(),this.diagramScene.editedBlock=n,this.diagramScene.editedBlock.isEdited=!0,this.diagramScene.onEdit=!0}},{key:"endDragging",value:function(t,e){var n=this;if(F.info("endDragging ".concat(t.name," : (").concat(e.x,", ").concat(e.y,")")),"mmroot"!==t.type){var o=this.diagramScene.blockLayout,r=this.diagramScene,i=r.diagramStructure,a=this.diagramScene.diagramStructure.getChildBlocks(t.uid).map((function(t){return n.diagramScene.diagramStructure.blocks.get(t)})),c=o.getBlocks(e);if(c=P.apply(void 0,[c,t].concat(Object(h.a)(a))),H.info("found N occupied blocks ".concat(c.length)),c.length>0){var l,s=c[0],d=[t.uid].concat(i.getChildBlocks(t.uid)),m=d.map((function(t){return i.blocks.get(t)}));this.diagramScene.diagramConnections=P(r.diagramConnections,i.blockConnections.input.get(t.uid)[0]),this.diagramScene.diagramBlocks=P.apply(void 0,[this.diagramScene.diagramBlocks].concat(Object(h.a)(m)));var p=r.diagramBlocks.indexOf(s);(l=r.diagramBlocks).splice.apply(l,[p+1,0].concat(Object(h.a)(m))),"mmroot"===s.type?e.x>0?r.diagramConnections.push(new Et({blockUid:s.uid,slot:"or"},{blockUid:d[0],slot:"i"},"mm")):r.diagramConnections.push(new Et({blockUid:s.uid,slot:"ol"},{blockUid:d[0],slot:"i"},"mm")):r.diagramConnections.push(new Et({blockUid:s.uid,slot:"o"},{blockUid:d[0],slot:"i"},"mm")),r.layout(),this.diagramScene.onEdit=!0}else{var y=o.getBlockColumn(t.uid),f=o.getColumnIdx(e.x);if(H.info("Block column ".concat(y,", position column ").concat(f)),f===y){var g=i.blockConnections.input.get(t.uid)[0],b=o.getChildIdx(t.uid,g.from.blockUid,e.y),k=Object(u.a)(b,2),v=k[0],O=k[1];if(H.info("Child idx ".concat(O,"[").concat(v,"]")),O.length>0){var w=-1,j=null;v===O.length||(w=O[v],j=r.diagramBlocks[w]);var S=[t.uid].concat(i.getChildBlocks(t.uid)).map((function(t){return i.blocks.get(t)}));if(r.diagramBlocks=P.apply(void 0,[r.diagramBlocks].concat(Object(h.a)(S))),j){var x,C=r.diagramStructure.blockConnections.input.get(j.uid)[0],B=r.diagramConnections.indexOf(C),D=this.diagramScene.diagramConnections.indexOf(g);this.diagramScene.diagramConnections.splice(D,1),this.diagramScene.diagramConnections.splice(B-1,0,g);var E=r.diagramBlocks.indexOf(j);(x=r.diagramBlocks).splice.apply(x,[E,0].concat(Object(h.a)(S)))}else{var M;(M=r.diagramBlocks).push.apply(M,Object(h.a)(S));var U=this.diagramScene.diagramConnections.indexOf(g);this.diagramScene.diagramConnections.splice(U,1),this.diagramScene.diagramConnections.push(g)}}r.layout(),this.diagramScene.onEdit=!0}else{var R=i.blockConnections.input.get(t.uid);"mmroot"===i.blocks.get(R[0].from.blockUid).type&&(e.x>0?R[0].from.slot="or":R[0].from.slot="ol"),r.layout(),this.diagramScene.onEdit=!0}}}}}]),e}(c.a.Component),Lt=Object(k.a)(It.prototype,"diagramScene",[S.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(k.a)(It.prototype,"removeBlock",[S.d],Object.getOwnPropertyDescriptor(It.prototype,"removeBlock"),It.prototype),Object(k.a)(It.prototype,"addBlock",[S.d],Object.getOwnPropertyDescriptor(It.prototype,"addBlock"),It.prototype),Object(k.a)(It.prototype,"endDragging",[S.d],Object.getOwnPropertyDescriptor(It.prototype,"endDragging"),It.prototype),Tt=It))||Tt,Nt=function(){if("undefined"!==typeof acquireVsCodeApi){var t=acquireVsCodeApi(),e=t.getState();return c.a.createElement(Xt,{jsonDiagram:e,vscode:t})}return c.a.createElement(Xt,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(c.a.createElement(Nt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[50,1,2]]]);
//# sourceMappingURL=main.945ba727.chunk.js.map